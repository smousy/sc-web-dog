!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sc=t():e.sc=t()}(this,(()=>(()=>{"use strict";var e=[function(e,t,s){var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var _=Object.getOwnPropertyDescriptor(t,s);_&&!("get"in _?!t.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,_)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),_=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),_(s(1),t),_(s(2),t),_(s(10),t),_(s(11),t),_(s(4),t),_(s(12),t),_(s(5),t),_(s(13),t),_(s(14),t),_(s(6),t),_(s(7),t),_(s(8),t),_(s(3),t)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScAddr=void 0,t.ScAddr=class{constructor(e=0){this._value=e}get value(){return this._value}isValid(){return 0!=this._value}equal(e){return this._value===e._value}}},function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(_,o){function c(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?_(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(c,r)}i((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ScClient=void 0;const _=s(3),o=s(1),c=s(4),r=s(5),i=s(6),a=s(7),d=s(9);t.ScClient=class{constructor(e){this.sendMessagesFromQueue=()=>{this._messageQueue.forEach((e=>e())),this._messageQueue=[]},this.onMessage=e=>{var t;const s=JSON.parse(e.data.toString()),n=s.id,_=this._callbacks[n];if(s.event){const e=this._events[n];if(!e)throw`Can't find callback for an event ${n}`;null===(t=e.callback)||void 0===t||t.call(e,new o.ScAddr(s.payload[0]),new o.ScAddr(s.payload[1]),new o.ScAddr(s.payload[2]),e.id)}else{if(!_)throw`Can't find callback for a command ${n}`;delete this._callbacks[n],_(s)}},this._socket="string"==typeof e?new WebSocket(e):e,this._socket.onmessage=this.onMessage,this._socket.onopen=this.sendMessagesFromQueue,this._messageQueue=[],this._callbacks={},this._events={},this._eventID=1}addEventListener(e,t){this._socket.addEventListener(e,t)}removeEventListener(e,t){this._socket.removeEventListener(e,t)}sendMessage(e,t,s){if(this._eventID++,this._callbacks[this._eventID])throw"Invalid state of messages queue";this._callbacks[this._eventID]=s;const n=JSON.stringify({id:this._eventID,type:e,payload:t}),_=()=>this._socket.send(n);this._socket.readyState===this._socket.OPEN?_():this._messageQueue.push(_)}resolveOrReject(e,t,s,n){return 0===n.length?e(s):t("string"==typeof n?n:n.map((({message:e})=>e)))}checkElements(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{if(!e.length)return t([]);const n=e.map((({value:e})=>e));this.sendMessage("check_elements",n,(({payload:e,errors:n})=>{const _=e.map((e=>new a.ScType(e)));this.resolveOrReject(t,s,_,n)}))}))}))}createElements(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.commands.map((t=>t.type.isNode()?{el:"node",type:t.type.value}:t.type.isEdge()?{el:"edge",type:t.type.value,src:(0,d.transformEdgeInfo)(e,t.data.src),trg:(0,d.transformEdgeInfo)(e,t.data.trg)}:t.type.isLink()?{el:"link",type:t.type.value,content:t.data.content,content_type:t.data.type}:void(0,_.invalidValue)("Unknown type"))).filter((e=>Boolean(e)));this.sendMessage("create_elements",n,(({payload:e,errors:n})=>{const _=e.map((e=>new o.ScAddr(e)));this.resolveOrReject(t,s,_,n)}))}))}))}createElementsBySCs(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{this.sendMessage("create_elements_by_scs",e,(({payload:e,errors:n})=>{this.resolveOrReject(t,s,e,n)}))}))}))}deleteElements(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((({value:e})=>e));this.sendMessage("delete_elements",n,(({status:e,errors:n})=>{this.resolveOrReject(t,s,e,n)}))}))}))}setLinkContents(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((e=>{var t;return{command:"set",type:e.typeToStr(),data:e.data,addr:null===(t=e.addr)||void 0===t?void 0:t.value}}));this.sendMessage("content",n,(({payload:e,errors:n})=>{this.resolveOrReject(t,s,e,n)}))}))}))}getLinkContents(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((({value:e})=>({command:"get",addr:e})));this.sendMessage("content",n,(({payload:e,errors:n})=>{const _=e.map((e=>new r.ScLinkContent(e.value,r.ScLinkContent.stringToType(e.type))));this.resolveOrReject(t,s,_,n)}))}))}))}getLinksByContents(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((e=>({command:"find",data:e})));this.sendMessage("content",n,(({payload:e,errors:n})=>{const _=e.map((e=>e.map((e=>new o.ScAddr(e)))));this.resolveOrReject(t,s,_,n)}))}))}))}getLinksByContentSubstrings(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((e=>({command:"find_links_by_substr",data:e})));this.sendMessage("content",n,(({payload:e,errors:n})=>{const _=e.map((e=>e.map((e=>new o.ScAddr(e)))));this.resolveOrReject(t,s,_,n)}))}))}))}getLinksContentsByContentSubstrings(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((e=>({command:"find_strings_by_substr",data:e})));this.sendMessage("content",n,(({payload:e,errors:n})=>{this.resolveOrReject(t,s,e,n)}))}))}))}resolveKeynodes(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{const n=e.map((({id:e,type:t})=>t.isValid()?{command:"resolve",idtf:e,elType:t.value}:{command:"find",idtf:e}));this.sendMessage("keynodes",n,(({payload:n,errors:_})=>{const c=n.map((e=>new o.ScAddr(e))).reduce(((t,s,n)=>Object.assign(Object.assign({},t),{[e[n].id]:s})),{});this.resolveOrReject(t,s,c,_)}))}))}))}processTripleItem({value:e,alias:t}){const s=t?{alias:t}:{};return e instanceof o.ScAddr?Object.assign({type:"addr",value:e.value},s):e instanceof a.ScType?Object.assign({type:"type",value:e.value},s):Object.assign({type:"alias",value:e},s)}processTemplate(e){return e instanceof o.ScAddr?{type:"addr",value:e.value}:"string"==typeof e&&/^[a-z0-9_]+$/.test(e)?{type:"idtf",value:e}:"string"==typeof e?e:e.triples.map((({source:e,edge:t,target:s})=>[this.processTripleItem(e),this.processTripleItem(t),this.processTripleItem(s)]))}processTemplateParams(e){return Object.keys(e).reduce(((t,s)=>{const n=e[s];return t[s]="string"==typeof n?n:n.value,t}),{})}templateSearch(e,t={}){return n(this,void 0,void 0,(function*(){return new Promise(((s,_)=>n(this,void 0,void 0,(function*(){const n={templ:this.processTemplate(e),params:this.processTemplateParams(t)};this.sendMessage("search_template",n,(({payload:e,status:t,errors:n})=>{if(!t)return s([]);const c=e.addrs.map((t=>{const s=t.map((e=>new o.ScAddr(e)));return new i.ScTemplateResult(e.aliases,s)}));this.resolveOrReject(s,_,c,n)}))}))))}))}templateGenerate(e,t={}){return n(this,void 0,void 0,(function*(){return new Promise(((s,_)=>n(this,void 0,void 0,(function*(){const n={templ:this.processTemplate(e),params:this.processTemplateParams(t)};this.sendMessage("generate_template",n,(({status:e,payload:t,errors:n})=>{e||s(null);const c=t.addrs.map((e=>new o.ScAddr(e))),r=new i.ScTemplateResult(t.aliases,c);this.resolveOrReject(s,_,r,n)}))}))))}))}eventsCreate(e){return n(this,void 0,void 0,(function*(){const t=Array.isArray(e)?e:[e];return new Promise(((e,s)=>{const n={create:t.map((({type:e,addr:t})=>({type:e,addr:t.value})))};this.sendMessage("events",n,(({payload:n,errors:_})=>{const o=t.map((({callback:e,type:t},s)=>{const _=n[s],o=new c.ScEvent(_,t,e);return this._events[_]=o,o}));this.resolveOrReject(e,s,o,_)}))}))}))}eventsDestroy(e){return n(this,void 0,void 0,(function*(){const t=Array.isArray(e)?e:[e];return new Promise(((e,s)=>{const n={delete:t};this.sendMessage("events",n,(({status:n,errors:_})=>{t.forEach((e=>{delete this._events[e]})),this.resolveOrReject(e,s,n,_)}))}))}))}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.invalidValue=void 0,t.invalidValue=e=>{((e,t)=>{throw`Invalid value: : ${t}`})(0,e)}},(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScEvent=t.ScEventType=void 0,(s=t.ScEventType||(t.ScEventType={})).Unknown="unknown",s.AddOutgoingEdge="add_outgoing_edge",s.AddIngoingEdge="add_ingoing_edge",s.RemoveOutgoingEdge="remove_outgoing_edge",s.RemoveIngoingEdge="remove_ingoing_edge",s.RemoveElement="delete_element",s.ChangeContent="content_change",t.ScEvent=class{constructor(e,t,s){this._id=0,this._type=null,this._callback=null,this._id=e,this._type=t,this._callback=s}get id(){return this._id}get type(){return this._type}get callback(){return this._callback}IsValid(){return this._id>0}}},(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ScLinkContent=t.ScLinkContentType=void 0,function(e){e[e.Int=0]="Int",e[e.Float=1]="Float",e[e.String=2]="String",e[e.Binary=3]="Binary"}(s=t.ScLinkContentType||(t.ScLinkContentType={})),t.ScLinkContent=class{constructor(e,t,s){this._data=e,this._type=t,this._addr=s}get data(){return this._data}get type(){return this._type}get addr(){return this._addr}typeToStr(){switch(this._type){case s.Binary:return"binary";case s.Float:return"float";case s.Int:return"int";default:return"string"}}static stringToType(e){switch(e){case"binary":return s.Binary;case"float":return s.Float;case"int":return s.Int;default:return s.String}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScTemplateResult=void 0,t.ScTemplateResult=class{constructor(e,t){this._addrs=[],this._indecies={},this._indecies=e,this._addrs=t}get size(){return this._addrs.length}get(e){return"string"==typeof e?this._addrs[this._indecies[e]]:this._addrs[e]}forEachTriple(e){for(let t=0;t<this.size;t+=3)e(this._addrs[t],this._addrs[t+1],this._addrs[t+2])}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScType=void 0;const n=s(8);class _{constructor(e){this._value=e||0}get value(){return this._value}hasConstancy(){return 0!=(this._value&n.sc_type_constancy_mask)}hasDirection(){return 0==(this._value&n.sc_type_uedge_common)}isNode(){return 0!=(this._value&n.sc_type_node)}isEdge(){return 0!=(this._value&n.sc_type_edge_mask)}isLink(){return 0!=(this._value&n.sc_type_link)}isConst(){return 0!=(this._value&n.sc_type_const)}isVar(){return 0!=(this._value&n.sc_type_var)}isPos(){return 0!=(this._value&n.sc_type_edge_pos)}isNeg(){return 0!=(this._value&n.sc_type_edge_neg)}isFuz(){return 0!=(this._value&n.sc_type_edge_fuz)}isPerm(){return 0!=(this._value&n.sc_type_edge_perm)}isTemp(){return 0!=(this._value&n.sc_type_edge_temp)}isAccess(){return 0!=(this._value&n.sc_type_edge_access)}isTuple(){return 0!=(this._value&n.sc_type_node_tuple)}isStruct(){return 0!=(this._value&n.sc_type_node_struct)}isRole(){return 0!=(this._value&n.sc_type_node_role)}isNoRole(){return 0!=(this._value&n.sc_type_node_norole)}isClass(){return 0!=(this._value&n.sc_type_node_class)}isAbstract(){return 0!=(this._value&n.sc_type_node_abstract)}isMaterial(){return 0!=(this._value&n.sc_type_node_material)}isValid(){return 0!==this._value}equal(e){return this._value===e._value}merge(e){const t=this._value&n.sc_type_element_mask,s=e._value&n.sc_type_element_mask;if((0!=t||0!=s)&&t!=s)throw"You can't merge two different syntax type";return new _(this._value|e._value)}changeConst(e){const t=this._value&~n.sc_type_constancy_mask;return new _(t|(e?n.sc_type_const:n.sc_type_var))}}t.ScType=_,_.EdgeUCommon=new _(n.sc_type_uedge_common),_.EdgeDCommon=new _(n.sc_type_dedge_common),_.EdgeUCommonConst=new _(n.sc_type_uedge_common|n.sc_type_const),_.EdgeDCommonConst=new _(n.sc_type_dedge_common|n.sc_type_const),_.EdgeUCommonVar=new _(n.sc_type_uedge_common|n.sc_type_var),_.EdgeDCommonVar=new _(n.sc_type_dedge_common|n.sc_type_var),_.EdgeAccess=new _(n.sc_type_edge_access),_.EdgeAccessConstPosPerm=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_pos),_.EdgeAccessConstNegPerm=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_neg),_.EdgeAccessConstFuzPerm=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_fuz),_.EdgeAccessConstPosTemp=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_pos),_.EdgeAccessConstNegTemp=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_neg),_.EdgeAccessConstFuzTemp=new _(n.sc_type_const|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_fuz),_.EdgeAccessVarPosPerm=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_pos),_.EdgeAccessVarNegPerm=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_neg),_.EdgeAccessVarFuzPerm=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_perm|n.sc_type_edge_fuz),_.EdgeAccessVarPosTemp=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_pos),_.EdgeAccessVarNegTemp=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_neg),_.EdgeAccessVarFuzTemp=new _(n.sc_type_var|n.sc_type_edge_access|n.sc_type_edge_temp|n.sc_type_edge_fuz),_.Const=new _(n.sc_type_const),_.Var=new _(n.sc_type_var),_.Node=new _(n.sc_type_node),_.Link=new _(n.sc_type_link),_.Unknown=new _,_.NodeConst=new _(n.sc_type_node|n.sc_type_const),_.NodeVar=new _(n.sc_type_node|n.sc_type_var),_.LinkConst=new _(n.sc_type_link|n.sc_type_const),_.LinkVar=new _(n.sc_type_link|n.sc_type_var),_.NodeStruct=new _(n.sc_type_node|n.sc_type_node_struct),_.NodeTuple=new _(n.sc_type_node|n.sc_type_node_tuple),_.NodeRole=new _(n.sc_type_node|n.sc_type_node_role),_.NodeNoRole=new _(n.sc_type_node|n.sc_type_node_norole),_.NodeClass=new _(n.sc_type_node|n.sc_type_node_class),_.NodeAbstract=new _(n.sc_type_node|n.sc_type_node_abstract),_.NodeMaterial=new _(n.sc_type_node|n.sc_type_node_material),_.NodeConstStruct=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_struct),_.NodeConstTuple=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_tuple),_.NodeConstRole=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_role),_.NodeConstNoRole=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_norole),_.NodeConstClass=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_class),_.NodeConstAbstract=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_abstract),_.NodeConstMaterial=new _(n.sc_type_node|n.sc_type_const|n.sc_type_node_material),_.NodeVarStruct=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_struct),_.NodeVarTuple=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_tuple),_.NodeVarRole=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_role),_.NodeVarNoRole=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_norole),_.NodeVarClass=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_class),_.NodeVarAbstract=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_abstract),_.NodeVarMaterial=new _(n.sc_type_node|n.sc_type_var|n.sc_type_node_material)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sc_type_edge_mask=t.sc_type_node_struct_mask=t.sc_type_permanency_mask=t.sc_type_positivity_mask=t.sc_type_constancy_mask=t.sc_type_element_mask=t.sc_type_arc_pos_var_perm=t.sc_type_arc_pos_const_perm=t.sc_type_node_material=t.sc_type_node_abstract=t.sc_type_node_class=t.sc_type_node_norole=t.sc_type_node_role=t.sc_type_node_struct=t.sc_type_node_tuple=t.sc_type_edge_perm=t.sc_type_edge_temp=t.sc_type_edge_fuz=t.sc_type_edge_neg=t.sc_type_edge_pos=t.sc_type_var=t.sc_type_const=t.sc_type_edge_access=t.sc_type_dedge_common=t.sc_type_uedge_common=t.sc_type_link=t.sc_type_node=void 0,t.sc_type_node=1,t.sc_type_link=2,t.sc_type_uedge_common=4,t.sc_type_dedge_common=8,t.sc_type_edge_access=16,t.sc_type_const=32,t.sc_type_var=64,t.sc_type_edge_pos=128,t.sc_type_edge_neg=256,t.sc_type_edge_fuz=512,t.sc_type_edge_temp=1024,t.sc_type_edge_perm=2048,t.sc_type_node_tuple=128,t.sc_type_node_struct=256,t.sc_type_node_role=512,t.sc_type_node_norole=1024,t.sc_type_node_class=2048,t.sc_type_node_abstract=4096,t.sc_type_node_material=8192,t.sc_type_arc_pos_const_perm=t.sc_type_edge_access|t.sc_type_const|t.sc_type_edge_pos|t.sc_type_edge_perm,t.sc_type_arc_pos_var_perm=t.sc_type_edge_access|t.sc_type_var|t.sc_type_edge_pos|t.sc_type_edge_perm,t.sc_type_element_mask=t.sc_type_node|t.sc_type_link|t.sc_type_uedge_common|t.sc_type_dedge_common|t.sc_type_edge_access,t.sc_type_constancy_mask=t.sc_type_const|t.sc_type_var,t.sc_type_positivity_mask=t.sc_type_edge_pos|t.sc_type_edge_neg|t.sc_type_edge_fuz,t.sc_type_permanency_mask=t.sc_type_edge_perm|t.sc_type_edge_temp,t.sc_type_node_struct_mask=t.sc_type_node_tuple|t.sc_type_node_struct|t.sc_type_node_role|t.sc_type_node_norole|t.sc_type_node_class|t.sc_type_node_abstract|t.sc_type_node_material,t.sc_type_edge_mask=t.sc_type_edge_access|t.sc_type_dedge_common|t.sc_type_uedge_common},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformEdgeInfo=void 0;const n=s(3);t.transformEdgeInfo=(e,t)=>{if("string"!=typeof t)return{type:"addr",value:t.value};const s=e.getIndex(t);return void 0===s?(0,n.invalidValue)(`Invalid alias: ${s}`):{type:"ref",value:s}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScConstruction=void 0;const n=s(3),_=s(11);t.ScConstruction=class{constructor(){this._commands=[],this._aliases={}}createNode(e,t){e.isNode()||(0,n.invalidValue)("You should pass node type there");const s=new _.ScConstructionCommand(e);t&&(this._aliases[t]=this._commands.length),this._commands.push(s)}createEdge(e,t,s,o){e.isEdge()||(0,n.invalidValue)("You should pass edge type there");const c=new _.ScConstructionCommand(e,{src:t,trg:s});o&&(this._aliases[o]=this._commands.length),this._commands.push(c)}createLink(e,t,s){e.isLink()||(0,n.invalidValue)("You should pass link type there");const o=new _.ScConstructionCommand(e,{content:t.data,type:t.type});s&&(this._aliases[s]=this._commands.length),this._commands.push(o)}get commands(){return this._commands}getIndex(e){return this._aliases[e]}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScConstructionCommand=void 0,t.ScConstructionCommand=class{constructor(e,t){this._elType=e,this._data=t}get type(){return this._elType}get data(){return this._data}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScEventParams=void 0,t.ScEventParams=class{constructor(e,t,s){this._addr=e,this._type=t,this._callback=s}get addr(){return this._addr}get type(){return this._type}get callback(){return this._callback}}},function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(_,o){function c(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?_(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(c,r)}i((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ScSet=void 0;const _=s(4),o=s(12),c=s(14),r=s(7);t.ScSet=class{constructor(e,t,s,n,_,o){if(this._elements={},this._scClient=null,this._addr=null,this._onAdd=null,this._onRemove=null,this._onInitialize=null,this._filterType=null,this._scClient=e,this._addr=t,this._onInitialize=s,this._onAdd=n,this._onRemove=_,this._filterType=o,!this._addr||!this._addr.isValid())throw`Invalid addr of set: ${this._addr}`}initialize(){var e;return n(this,void 0,void 0,(function*(){if(!this._addr)return;const t=yield null===(e=this._scClient)||void 0===e?void 0:e.eventsCreate([new o.ScEventParams(this._addr,_.ScEventType.AddOutgoingEdge,this.onEventAddElement.bind(this)),new o.ScEventParams(this._addr,_.ScEventType.RemoveOutgoingEdge,this.onEventRemoveElement.bind(this))]);return this._evtAddElement=null==t?void 0:t[0],this._evtRemoveElement=null==t?void 0:t[1],yield this.iterateExistingElements(),new Promise((function(e){e()}))}))}shouldAppend(e){var t;return n(this,void 0,void 0,(function*(){const s=yield null===(t=this._scClient)||void 0===t?void 0:t.checkElements(e),n=null==s?void 0:s.map((e=>!(this._filterType&&(this._filterType.value&e.value)!==this._filterType.value)));return new Promise((function(e){e(n)}))}))}onEventAddElement(e,t,s){return n(this,void 0,void 0,(function*(){if(!this._elements[t.value]&&s.isValid()){const e=yield this.shouldAppend([s]);(null==e?void 0:e[0])&&(this._elements[t.value]=s,this.callOnAdd(s))}return new Promise((function(e){e()}))}))}onEventRemoveElement(e,t){return n(this,void 0,void 0,(function*(){const e=this._elements[t.value];if(!e)throw`Invalid state of set: ${this._addr} (try to remove element ${t}, that doesn't exist)`;return yield this.callOnRemove(e),delete this._elements[t.value],new Promise((function(e){e()}))}))}callOnInitialize(e){return n(this,void 0,void 0,(function*(){return this._onInitialize&&(yield this._onInitialize(e)),new Promise((function(e){e()}))}))}callOnAdd(e){return n(this,void 0,void 0,(function*(){return this._onAdd&&(yield this._onAdd(e)),new Promise((function(e){e()}))}))}callOnRemove(e){return n(this,void 0,void 0,(function*(){return this._onRemove&&(yield this._onRemove(e)),new Promise((function(e){e()}))}))}iterateExistingElements(){return n(this,void 0,void 0,(function*(){if(!this._addr||!this._scClient)return;const e=[],t=new c.ScTemplate;t.triple(this._addr,[r.ScType.EdgeAccessVarPosPerm,"_edge"],[r.ScType.Unknown,"_item"]);const s=yield this._scClient.templateSearch(t),n=(null==s?void 0:s.map((e=>e.get("_item"))))||[],_=yield this.shouldAppend(n);for(let t=0;t<s.length;++t){if(!(null==_?void 0:_[t]))continue;const n=s[t].get("_edge"),o=s[t].get("_item");if(this._elements[n.value])throw`Element ${o} already exist in set`;this._elements[n.value]=o,e.push(o)}return yield this.callOnInitialize(e),new Promise((function(e){e()}))}))}addItem(e){return n(this,void 0,void 0,(function*(){if(!this._addr||!this._scClient)return;let t=!1;const s=new c.ScTemplate;if(s.triple(this._addr,[r.ScType.EdgeAccessVarPosPerm,"_edge"],[e,"_item"]),0==(yield this._scClient.templateSearch(s)).length){const n=yield this._scClient.templateGenerate(s,{_item:e});if(n){const e=n.get("_item");t=e&&e.isValid()}}return new Promise((function(e){e(t)}))}))}}},(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScTemplate=void 0;const n=s(1),_=s(7);t.ScTemplate=class{constructor(){this._triples=[]}get triples(){return this._triples}triple(e,t,s){const n=this.splitTemplateParam(e),_=this.splitTemplateParam(t),o=this.splitTemplateParam(s);return this._triples.push({source:n,edge:_,target:o}),this}tripleWithRelation(e,t,s,n,_){let{alias:o,value:c}=this.splitTemplateParam(t);return o||(o=`edge_1_${this._triples.length}`),this.triple(e,[c,o],s),this.triple(_,n,o),this}splitTemplateParam(e){if(e instanceof Array){if(2!==e.length)throw"Invalid number of values for remplacement. Use [ScType | ScAddr, string]";const t=e[0],s=e[1];if(!(t instanceof n.ScAddr||t instanceof _.ScType)||"string"!=typeof s)throw"First parameter should be ScAddr or ScType. The second one - string";return{alias:s,value:t}}return{alias:null,value:e}}}}],t={};return function s(n){var _=t[n];if(void 0!==_)return _.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,s),o.exports}(0)})()));